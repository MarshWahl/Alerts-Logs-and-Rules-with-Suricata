# Alerts-Logs-and-Rules-with-Suricata

## Scenario
First, I will explore current custom rules in Suricata within an example setting. Second, I will run Suricata with the custom rule in order to trigger an alert, and examine the output logs in the fast.log file. Finally, I will examine the additional output that Suricata generates in the standard eve.json log file.

### Examine a custom rule in Suricata
In this system, the /home/analyst directory contains a custom.rules file that defines the network traffic rules, which Suricata captures.
Using the **cat** command, we will display the contents of the custom.rules file, as shown below:
![image](https://github.com/user-attachments/assets/b9520375-cd4d-402c-becb-b477884611df)
This rule consists of three components: an **action**, a **header**, and **rule options**.

The **action** is the first part of the signature. It determines the action to take if all conditions are met. In this custom rule, the **action** is "alert".
The next part of the signature is the **header**. The **header** defines the signatureâ€™s network traffic, which includes attributes such as protocols, source and destination IP addresses, source and destination ports, and traffic direction. In this custom rule, the **header** is "http $HOME_NET any -> $EXTERNAL_NET any".
  Breaking the **header** down further; "http" is the protocol, determining that the rule applies only to HTTP traffic.
  "$HOME_NET any -> $EXTERNAL_NET any" are the parameters to the protocol field. The "->" indicates the direction of the traffic coming from the "$HOME_NET" (a Suricata variable already defined as the local or home network) and going to the destination IP address "$EXTERNAL_NET".
  The words "any" mean that Suricata catches traffic from any port defined in the "$HOME_NET" network.
The final portion of the signature are the **rule options**. This is everything included in the parenthesis: "(msg:"GET on wire"; flow:established, to_server; content:"GET"; http_method; sid:12345; rev:3;)".
  Breaking the **rule options** down further; "msg:" is an option that provides the "alert" text to print out. In this case, the alert will print out "GET on wire", which specifies why the alert was triggered.
  "flow:established, to_server" is an option that determines that packets from the client to the server should be matched.
  The "content:"GET"" option tells Suricata to look for the word "GET" in the content of the "http.method" portion of the packet.
  The "sid:12345" (signature ID) is an option with a unique numerical value that identifies the rule.
  The "rev:3" option indicates the signature's revision, which is used to identify hte signature's version.

### Triggering a custom rule in Suricata
Here, I will use a sample.pcap file to mimic network traffic through Suricata using the rules defined in "custom.rules".
To do this, I will use the command line: "sudo suricata -r sample.pcap -S custom.rules -k none".
  "-r sample.pcap" specifies an input file to mimic network traffic.
  "-S custom.rules" instructs Suricata to use the rules defined in "custom.rules".
  "-k none" option instructs Suricata to disable all checksum checks, since we are using a sample packet capture file, I won't need Suricata to check the integrity of the checksum.
Running this command line will provide output similar to the following:
![image](https://github.com/user-attachments/assets/b13b50f3-5f44-4401-bdb8-d080cc4c2116)

Now I will check the Suricata log files to see if an alert line was added if all the conditions in any of the rules were met. I will use the command "ls -l /var/log/suricata" to list all log files, producing the following output:
![image](https://github.com/user-attachments/assets/786b97c1-7a69-4efd-8804-eab2a42cdc29)
The output shows four files in the directory, including the "fast.log" and "eve.json" files.

### Examine the fast.log and eve.json files in more detail
Now that I have Suricata log files that were created through alerts being triggered by Suricata, I will take a closer look at the "fast.log" and "eve.json" files.
Starting with the "fast.log" file, I will use the command "cat /var/log/suricata/fast.log" to display it's contents, resulting in the following output:
![image](https://github.com/user-attachments/assets/ffd4fce1-4c91-437d-88ca-499e5891e2f1)
Here, each entry in the "fast.log" corresponds to an alert generated by Suricata when it processed a packet that met the conditions of an alert generating rule. Each alert includes the message that identifies the rule triggered, as well as the source, destination, and direction of the traffic.

Next I will display the contents of the "eve.json" file. This is the standard and main Suricata log file, containing more data than the "fast.log" file.
Using the command "cat /var/log/suricata/eve.json" will display it's contents, resulting in the following output:
![image](https://github.com/user-attachments/assets/42bab3a6-cd2e-45d9-9ec1-82733a2562b5)
This returns the raw content of the file, which contains a lot of data in a format not easily understood. To remedy this, I will use the following command "jq . /var/log/suricata/eve.json | less" which displays the output in an improved format, such as the following:
![image](https://github.com/user-attachments/assets/91441b92-b2e5-41df-b0c8-ad81ea4fc3c5)
Within this view, the "f" and "b" keys can be used to move forward and backward through the output. Pressing "Q" will exit the view.

I will utilize the **jq** command further to filter and extract specific event data from the "eve.json" file.
For example, the command "jq -c "[.timestamp,.flow_id,.alert.signature,.proto,.dest_ip]" /var/log/suricata/eve.json" will extract the fields "timestamp", "flow id", "alert signature", "protocol", and the "destination IP address". Resulting in the following output:
![image](https://github.com/user-attachments/assets/3b7fc42c-20b4-4817-a43a-c1678eb90329)
